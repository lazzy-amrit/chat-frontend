<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Neon Cyber Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

:root {
  --bg: #050510;
  --neon: #00f7ff;
  --pink: #ff00c8;
  --card: rgba(20,20,40,0.6);
}

* {
  box-sizing: border-box;
  margin:0;
  padding:0;
  font-family: "Segoe UI", sans-serif;
}

body {
  background: radial-gradient(circle at top, #0d0d25, #050510);
  color: white;
  height:100vh;
  overflow:hidden;
}

/* ---------- Intro ---------- */

#intro, #login, #chatApp {
  position:absolute;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  transition:opacity .6s ease, transform .6s ease;
}

.hidden {
  opacity:0;
  pointer-events:none;
  transform:scale(.98);
}

.glow-text {
  font-size:28px;
  text-align:center;
  text-shadow:0 0 10px var(--neon), 0 0 20px var(--neon);
}

.sub {
  font-size:13px;
  margin-top:8px;
  opacity:.7;
}

.neon-btn {
  margin-top:25px;
  padding:10px 25px;
  background:transparent;
  border:2px solid var(--neon);
  color:white;
  cursor:pointer;
  border-radius:8px;
  transition:.3s;
}

.neon-btn:hover {
  background:var(--neon);
  color:black;
  box-shadow:0 0 20px var(--neon);
}

/* ---------- Login ---------- */

.card {
  background:var(--card);
  backdrop-filter:blur(15px);
  padding:30px;
  border-radius:15px;
  border:1px solid var(--neon);
  box-shadow:0 0 20px rgba(0,247,255,.3);
  width:90%;
  max-width:350px;
  text-align:center;
}

.card input {
  width:100%;
  padding:10px;
  margin:8px 0;
  border:none;
  border-radius:6px;
  background:#101030;
  color:white;
}

.error {
  color:#ff4d4d;
  font-size:13px;
}

/* ---------- Chat ---------- */

#chatApp {
  padding:15px;
  display:flex;
  flex-direction:column;
}

.topbar {
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  font-size:14px;
}

.badge {
  background:var(--pink);
  padding:4px 10px;
  border-radius:20px;
  box-shadow:0 0 10px var(--pink);
}

#messages {
  flex:1;
  overflow-y:auto;
  padding-right:5px;
}

.msg {
  margin:8px 0;
  padding:10px;
  border-radius:10px;
  max-width:70%;
  animation:slideIn .3s ease;
}

.self {
  align-self:flex-end;
  background:var(--neon);
  color:black;
}

.other {
  background:#1a1a3a;
  border:1px solid var(--neon);
}

.system {
  text-align:center;
  font-size:12px;
  opacity:.7;
}

@keyframes slideIn {
  from { transform:translateY(10px); opacity:0; }
  to { transform:translateY(0); opacity:1; }
}

.input-area {
  display:flex;
  margin-top:10px;
}

.input-area input {
  flex:1;
  padding:10px;
  border:none;
  border-radius:6px;
  background:#101030;
  color:white;
}

.input-area button {
  margin-left:5px;
  padding:10px 15px;
  border:none;
  border-radius:6px;
  background:var(--neon);
  cursor:pointer;
}

.typing {
  font-size:12px;
  opacity:.7;
  height:16px;
}

@media(max-width:600px){
  .msg { max-width:85%; }
}

</style>
</head>
<body>

<!-- INTRO -->
<div id="intro">
  <div class="glow-text" id="introText"></div>
  <div class="sub">Right your username below</div>
  <button class="neon-btn" onclick="showLogin()">Login</button>
</div>

<!-- LOGIN -->
<div id="login" class="hidden">
  <div class="card">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <div id="error" class="error"></div>
    <button class="neon-btn" onclick="login()">Enter</button>
  </div>
</div>

<!-- CHAT -->
<div id="chatApp" class="hidden">
  <div class="topbar">
    <div>Neon Room</div>
    <div class="badge" id="count">0 Online</div>
  </div>

  <div id="messages"></div>
  <div class="typing" id="typing"></div>

  <div class="input-area">
    <input id="msgInput" placeholder="Type message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>

/* ---------------- CONFIG ---------------- */
const WS_URL = "wss://enhancing-calls-deny-annie.trycloudflare.com";  // REPLACE THIS
/* ---------------------------------------- */

let ws;
let myUsername = "";
let typingTimeout;

/* ---------- Intro typing effect ---------- */

const introSentence = "Hi, This is made by Lazzy Codeks and currently in trial phase.";
let i = 0;

function typeIntro(){
  if(i < introSentence.length){
    document.getElementById("introText").innerHTML += introSentence[i];
    i++;
    setTimeout(typeIntro, 35);
  }
}
typeIntro();

/* ---------- Page switching ---------- */

function showLogin(){
  document.getElementById("intro").classList.add("hidden");
  document.getElementById("login").classList.remove("hidden");
}

/* ---------- Login ---------- */

function login(){
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value;

  if(!username || !password){
    document.getElementById("error").innerText="Fill all fields";
    return;
  }

  ws = new WebSocket(WS_URL);

  ws.onopen = () => {
    ws.send(JSON.stringify({
      type:"login",
      username,
      password
    }));
  };

  ws.onmessage = (e) => {
    const data = JSON.parse(e.data);

    if(data.type==="error"){
      document.getElementById("error").innerText=data.message;
      return;
    }

    if(data.type==="history"){
      myUsername=username;
      localStorage.setItem("username",username);

      document.getElementById("login").classList.add("hidden");
      document.getElementById("chatApp").classList.remove("hidden");

      data.messages.forEach(addMessage);
    }

    if(data.type==="message") addMessage(data);

    if(data.type==="join")
      addSystem(`${data.username} joined`);

    if(data.type==="leave")
      addSystem(`${data.username} left`);

    if(data.type==="count")
      document.getElementById("count").innerText =
        `${data.count} Online`;

    if(data.type==="typing"){
      const users=data.users.filter(u=>u!==myUsername);
      document.getElementById("typing").innerText =
        users.length ? users.join(", ")+" typing..." : "";
    }
  };
}

/* ---------- Messages ---------- */

function addMessage(data){
  const div=document.createElement("div");
  div.classList.add("msg");
  div.classList.add(data.username===myUsername ? "self":"other");
  div.innerText=`${data.username}: ${data.message}`;
  document.getElementById("messages").appendChild(div);
  scrollDown();
}

function addSystem(text){
  const div=document.createElement("div");
  div.classList.add("system");
  div.innerText=text;
  document.getElementById("messages").appendChild(div);
  scrollDown();
}

function scrollDown(){
  const m=document.getElementById("messages");
  m.scrollTop=m.scrollHeight;
}

/* ---------- Send ---------- */

function sendMessage(){
  const input=document.getElementById("msgInput");
  const msg=input.value.trim();
  if(!msg) return;

  ws.send(JSON.stringify({
    type:"message",
    message:msg
  }));

  input.value="";
}

/* ---------- Typing indicator ---------- */

document.getElementById("msgInput")
.addEventListener("input",()=>{
  ws.send(JSON.stringify({type:"typing",status:true}));
  clearTimeout(typingTimeout);
  typingTimeout=setTimeout(()=>{
    ws.send(JSON.stringify({type:"typing",status:false}));
  },1000);
});

/* ---------- Auto username fill ---------- */

window.onload=()=>{
  const saved=localStorage.getItem("username");
  if(saved)
    document.getElementById("username").value=saved;
};

</script>

</body>
</html>
